{% extends 'base.html.twig' %}

{% block title %}Collection de {{ utilisateur.prenom }} {{ utilisateur.nom|default('') }}{% endblock %}

{% block body %}
    <div class="container my-5">
        
        {# --- HEADER & MAIN TITLE --- #}
        <h1 class="h2 mb-2 text-dark">
            <i class="bi bi-collection-fill me-2 text-primary"></i> Collection de jeux de {{ utilisateur.prenom }} {{ utilisateur.nom|default('') }}
        </h1>
        <p class="text-muted lead mb-4">
            Parcourez tous les jeux de cette collection.
        </p>

        {# --- ACTION BUTTONS --- #}
        <div class="d-flex mb-5 gap-3">
            <a href="{{ path('app_collect_new', {'id': utilisateur.id}) }}" class="btn btn-success btn-lg shadow-sm">
                <i class="bi bi-plus-circle-fill me-1"></i> Ajouter un jeu
            </a>
            <a href="{{ path('app_collect_index') }}" class="btn btn-outline-secondary btn-lg">
                <i class="bi bi-arrow-left"></i> Retour à la liste des utilisateurs
            </a>
        </div>
        
        {# --- COLLECTION GRID --- #}
        <div class="row">
            {% if collection is not empty %}
                {% for collect in collection %}
                    
                    {# Set status variables for styling #}
                    {% set status_name = collect.statut.name|lower %}
                    {% set status_class = status_name == 'terminé' ? 'success' : (status_name == 'en cours' ? 'warning' : 'info') %}

                    <div class="col-md-6 col-lg-4 mb-4">
                        {# The entire card links to the detail page #}
                        <a href="{{ path('app_collect_show_by_ids', {'collect_id': collect.id}) }}" class="text-decoration-none text-dark">
                            <div class="card shadow-lg h-100 border-{{ status_class }} border-3 border-start">

                                {# Card Header: Game Title & Status Badge #}
                                <div class="card-header bg-light border-bottom d-flex justify-content-between align-items-center py-3">
                                    <h5 class="mb-0 fw-bold text-truncate me-2">{{ collect.jeuvideo.titre }}</h5>
                                    <span class="badge text-bg-{{ status_class }}">
                                        {{ collect.statut.name|capitalize }}
                                    </span>
                                </div>

                                <div class="card-body d-flex flex-column p-4">
                                    
                                    {# --- Game Details --- #}
                                    <dl class="row mb-3 small">
                                        <dt class="col-sm-6 text-muted">Éditeur :</dt>
                                        <dd class="col-sm-6 text-end">{{ collect.jeuvideo.editeur.nom|default('N/A') }}</dd>

                                        <dt class="col-sm-6 text-muted">Genre :</dt>
                                        <dd class="col-sm-6 text-end">{{ collect.jeuvideo.genre.nom|default('N/A') }}</dd>

                                        <dt class="col-sm-6 text-muted">Date de Sortie :</dt>
                                        <dd class="col-sm-6 text-end">
                                            {{ collect.jeuvideo.dateSortie ? collect.jeuvideo.dateSortie|date('Y') : 'N/A' }}
                                        </dd>
                                    </dl>

                                    <hr>

                                    {# --- Collection Details (Pricing) --- #}
                                    <h6 class="card-subtitle mb-3 text-primary"><i class="bi bi-wallet2 me-1"></i> Infos Achat</h6>

                                    <dl class="row small fw-medium mb-3">
                                        <dt class="col-sm-6">Prix Neuf :</dt>
                                        <dd class="col-sm-6 text-end">{{ collect.jeuvideo.prix|default('0.00')|number_format(2, ',', ' ') }} €</dd>

                                        <dt class="col-sm-6 text-success">Prix Acheté :</dt>
                                        <dd class="col-sm-6 text-end text-success">
                                            {% if collect.prixAchat is not null %}
                                                **{{ collect.prixAchat|number_format(2, ',', ' ') }} €**
                                            {% else %}
                                                Non renseigné
                                            {% endif %}
                                        </dd>
                                    </dl>

                                    {# --- Economy Display --- #}
                                    {% set prix_neuf = collect.jeuvideo.prix|default(0) %}
                                    {% set prix_achete = collect.prixAchat|default(0) %}
                                    {% set economie = prix_neuf - prix_achete %}

                                    {% if prix_neuf > 0 and collect.prixAchat is not null %}
                                        <div class="alert alert-success p-2 mt-auto text-center small mb-0">
                                            Économie: **{{ economie|number_format(2, ',', ' ') }} €**
                                        </div>
                                    {% endif %}

                                </div>
                                
                                {# Card Footer: Quick Actions #}
                                <div class="card-footer bg-white d-flex justify-content-between pt-3 border-top-0">
                                    {# Link to Edit Page #}
                                    <a href="{{ path('app_collect_edit', {'id': collect.id}) }}" class="btn btn-warning btn-sm">
                                        <i class="bi bi-pencil-square"></i> Modifier
                                    </a>
                                    
                                    {# Link to Show Page (if needed, although the card is clickable) #}
                                    <a href="{{ path('app_collect_show_by_ids', {'collect_id': collect.id}) }}" class="btn btn-outline-primary btn-sm">
                                        <i class="bi bi-info-circle"></i> Détails
                                    </a>

                                    {# Using the modernized delete partial (assuming you have one for Collect) #}
                                    {{ include('collect/_delete_form.html.twig', {'collect': collect, 'button_class': 'btn btn-outline-danger btn-sm'}) }}
                                </div>
                            </div>
                        </a>
                    </div>
                {% endfor %}
            {% else %}
                <div class="col-12">
                   <p class="alert alert-info">
                       <i class="bi bi-info-circle me-2"></i> Cette collection est vide. 
                       <a href="{{ path('app_collect_new', {'id': utilisateur.id}) }}" class="btn btn-success btn-sm ms-2">
                            <i class="bi bi-plus-circle"></i> Ajouter un jeu
                       </a> 
                   </p>
                </div>
            {% endif %}
        </div>
    </div>

{% endblock %}